-- EJERCICIO 8


insert into responsable values('02','0300');
insert into responsable values('03','0300');
insert into responsable values('04','0300');

insert into responsable values('07','0100');
insert into responsable values('08','0100');

insert into responsable values('14','1500');

insert into responsable values('07','1200');
insert into responsable values('10','1200');
insert into responsable values('07','1200');
insert into responsable values('15','1200');

/*
	SE PUEDE PONER UNA SELECT CON UN COUNT() Y OTROS DATOS,
	SE USA EL ATRIBUTO IDENTIFICADOR PARA COGER SU VALOR EN 
	UN CURSOR


	SIEMPRE QUE USEMOS HAVING / HAVING COUNT() HAY QUE PONER UN
	GROUP BY todos los datos de la select menos otros count

*/
        select e.nif, count(*) dirige
        from entrenador e, responsable r, equipo eq
        where e.nif = r.entrenador and

        group by e.nif
        having count(*) < 5
        order by e.nif;
		
		
		
		create or replace procedure ejercicio8julio is


    -- ENTRENADORES QUE SE ECUENTRAN EN LA TABLA RESPONSABLE
    -- Y DIRIGEN MENOS DE 5 EQUIPOS, JUNTO LA CANTIDAD DE
    -- EQUIPOS QUE SON RESPONSABLES
    cursor listadoEntrenadores is
        select e.nif, eq.codigo, eq.nombre, count(*) dirige
        from entrenador e, responsable r, equipo eq
        where e.nif = r.entrenador and
            r.equipo = eq.codigo
        group by e.nif, eq.codigo, eq.nombre
        having count(*) < 5
        order by e.nif;
    
    -- CONTADOR PARA SAVER LOS EQUIPOS RECORRIDO POR ENTRENADOR
    contadoraux number(4);
    
begin
    
    contadoraux := 1;

    for reg in listadoEntrenadores loop
        
        if contadoraux = 1 then
            escribir('+++++ ENTRENADOR: '||reg.nif||' '||reg.dirige||'++++++');
        elsif contadoraux < reg.dirige then
            escribir('+dirige: ' ||reg.codigo||' '||reg.nombre);
            contadoraux := contadoraux + 1;
        else
            escribir('+dirige: ' ||reg.codigo||' '||reg.nombre);
            contadoraux := 0;
        end if;
        
    end loop;


end;