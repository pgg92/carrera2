-- PRUEBAS SELECT EJERCICIOS REPASO

-- EJERCICIO1:
-- EQUIPOS MISMO NIVEL Y ASOCIACION QUE EL ENTRENADOR EN SU ASOCIACION

  /*
  MAL: la select devuelve varias filas no se puede guardar
  todo en una variable (mismoNivel)
  
  select nivel into mismoNivel from equipo, asociacion 
  where equipo.ASOCIACION = asociacion.codigo;
  
  select count(*) into cuentaNiveles from entrenador, asociacion 
  where entrenador.asociacion = asociacion.codigo and entrenador.nif = pnif
  and entrenador.nivel = mismoNivel;
  */

create or replace function ejercicio1julio(pnif entrenador.nif%type)  
return char is 

  mismoNivel equipo.nivel%type;
  cuentaNiveles number;
  comprobarNif number;
  valor char(9);
  no_nif exception;
  entasociacion asociacion.codigo%type;
  
begin 

  valor := 'activo';
  cuentaNiveles := 0;
  
  select count(*) into comprobarNif from entrenador 
  where entrenador.nif = pnif;
  escribir('Entrenadores encontrados por el nifPasado:' || comprobarNif);
  
  if comprobarNif = 0 then
    raise no_nif;
  end if;
  
  select asociacion into entasociacion from entrenador
  where entrenador.nif = pnif;
  escribir('Asociacion a la que pertenece el entrandor:' || entasociacion);
  
  select count(*) into cuentaNiveles from entrenador, equipo
  where entrenador.nif = pnif and equipo.asociacion = entasociacion
    and equipo.nivel = entrenador.nivel;
  escribir('Equipos con mismo nivel y asociacion que el entrenador:' || cuentaNiveles);
  
  if cuentaNiveles = 0 then
    valor := 'reubicar';
  elsif cuentaNiveles > 0 then
    valor := 'activo';
  end if;
  
  return valor;
  
  
  exception
      when no_nif then
      escribir('El nif introducido no esta en la bbdd');
      return null;
    
  end;

