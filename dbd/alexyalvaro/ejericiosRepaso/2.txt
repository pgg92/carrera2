
--EJERCICIO2:
-- CUANDO UNA OPERACION VINCULE A UN ENTRENADOR
-- COMPROBAR QUE ALMENOS UN EQUIPO PERTENECE A LA ASOCIACION
-- COMPROBAR NIVEL ENTRENADOR SUPERIOR A 5
	-- SI TIENE: INCREMENTAR DESTACADOS EN 1

	
/*
	no he conseguido insertar un entrenador
	sale no data found en la primera select, pero es un count(*) y no debe saltar
	en todo caso devolveria 0 y el update ni idea de porque falla 

	no hay errores de compilacion
	
*/
	
	
create or replace trigger ejercicio2julio
before insert or update of asociacion on entrenador
for each row
declare
    perteneceEquipo number;
    nivelEntrenador entrenador.nivel%type;
begin
    perteneceEquipo := 0;

    select count(*) into perteneceEquipo from equipo
    where equipo.asociacion = :new.asociacion;

    select nivel into nivelEntrenador from entrenador
    where entrenador.nif = :new.nif;

    if perteneceEquipo = 0 then
        raise_application_error(-20101,'No hay equipos asociados');

    elsif :new.nivel > 5 then
        update asociacion set(destacados) =
            (select destacados from asociacion where codigo = :new.asociacion + 1)
                where asociacion.codigo = :new.asociacion;
    end if;

end;